(()=>{"use strict";var t={55:function(t,e,n){var o,i=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,o,i)}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||(o=function(t){return o=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},o(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=o(t),r=0;r<n.length;r++)"default"!==n[r]&&i(e,t,n[r]);return s(e,t),e}),a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Gamepage=void 0;const l=r(n(407)),h=a(n(373)),c=new AbortController,d=c.signal;class g extends h.default{constructor(t){super(t),this.cntNode=-1,this.animationFrameId=-1,this.animationTime=-1,this.animationFPS=120,this.canvasSize={height:500,width:500},this.bgColor="#0b0f1a",this.bgGridStyle={origin:{y:this.canvasSize.width/2,x:this.canvasSize.height/2},grid:{height:80,width:80},color:"#111829",lineWidth:1}}setCallback(t){this.callback=t}changePage(t={cntNode:10}){this.root.innerHTML='\n            <section class="screen-game">\n                <h1>Graph to Plain!</h1>\n                <canvas id="game_playground"></canvas>\n                <p id="info"></p>\n            </section>',this.cntNode=t.cntNode,this.gameScreen=document.getElementById("game_playground"),this.textInfo=document.getElementById("info");const e=this.gameScreen.getContext("2d");this.ctx=e,this.gameScreen.height=this.canvasSize.height,this.gameScreen.width=this.canvasSize.width;const n=new l.Graph(e);this.createPlanegraph(n,5),n.updateEdgeColor(),n.loop(0),this.settingCanvasEvent(n);const o=t=>{const i=t;-1==this.animationTime&&(this.animationTime=i),i-this.animationTime>1e3/this.animationFPS&&(this.animationTime=i,e.clearRect(0,0,this.canvasSize.height,this.canvasSize.width),this.drawBackground(),n.loop(this.animationTime)),requestAnimationFrame(o)};this.animationFrameId=requestAnimationFrame(o)}drawBackground(){const{height:t,width:e}=this.canvasSize,{origin:n,grid:o,color:i,lineWidth:s}=this.bgGridStyle,r=this.ctx;if(!r)throw new Error("Property is unsetted");r.fillStyle=this.bgColor,r.fillRect(0,0,e,t);for(let t=0;n.x+o.width*t<=e;t++)this.drawVerticalLine(n.x+o.width*t,i,s,r);for(let t=1;n.x-o.width*t>=0;t++)this.drawVerticalLine(n.x-o.width*t,i,s,r);for(let e=0;n.y+o.height*e<=t;e++)this.drawHorizontalLine(n.y+o.height*e,i,s,r);for(let t=1;n.y-o.height*t>=0;t++)this.drawHorizontalLine(n.y-o.height*t,i,s,r)}drawVerticalLine(t,e,n,o){o.strokeStyle=e,o.lineWidth=n,o.beginPath(),o.moveTo(t,0),o.lineTo(t,this.canvasSize.height),o.stroke()}drawHorizontalLine(t,e,n,o){o.strokeStyle=e,o.lineWidth=n,o.beginPath(),o.moveTo(0,t),o.lineTo(this.canvasSize.width,t),o.stroke()}settingCanvasEvent(t){if(!this.gameScreen)throw new Error("Property is unsetted");let e=!1,n=0,o=0,i=0,s=0,r=null;this.gameScreen.addEventListener("mousedown",a=>{if(!this.gameScreen)throw new Error("Property is unsetted");const l=this.gameScreen.getBoundingClientRect(),h=a.clientX-l.left,c=a.clientY-l.top;n=h,o=c,r=t.getClosestNode(h,c),r&&(r.status="drag");const d=null==r?void 0:r.getPos();null!=d&&(i=d[0],s=d[1]),e=!0},{signal:d}),this.root.addEventListener("mousemove",a=>{if(!e)return;if(!this.gameScreen)throw new Error("Property is unsetted");const l=this.gameScreen.getBoundingClientRect(),h=a.clientX-l.left,c=a.clientY-l.top,d=Math.min(Math.max(h-n+i,18),this.canvasSize.width-18),g=Math.min(Math.max(c-o+s,18),this.canvasSize.height-18);null==r||r.setPos(d,g),t.updateEdgeColor()}),this.root.addEventListener("mouseup",n=>{e&&(r&&(r.status="normal"),e=!1,t.checkCrossedGraph()||this.finishGame(t))})}createPlanegraph(t,e){const n=t.getCtx(),o=e;let i=null;for(let e=0;e<o;e++){let o=460*Math.random()+20,s=460*Math.random()+20;const r=new l.GraphNode(n,o,s,e);t.addGraphElement(r),0==this.getRandint(0,2)&&null!=i&&t.addGraphElement(new l.GraphEdge(n,i,r)),i=r}const s=t.getNodes(),r=this.createPlanegraphEdges(o);for(const e of r)t.addGraphElement(new l.GraphEdge(n,s[e[0]],s[e[1]]));this.textInfo&&(this.textInfo.innerText=`node:${o} edge:${r.length}`)}createPlanegraphEdges(t){let e=[],n=[],o=0;for(;o<1e3;){const i=0==this.getRandint(0,2),s=this.getRandint(0,t-2),r=[s,this.getRandint(s+2,t)];if(i&&this.checkCrossing(e,r))e.push(r);else{if(!this.checkCrossing(n,r)){o++;continue}n.push(r)}o=0}return console.log(e.sort()),console.log("-----"),console.log(n.sort()),e.concat(n)}checkCrossing(t,e){for(const n of t){const t=n[0]<=e[0]&&e[1]<=n[1],o=e[0]<=n[0]&&n[1]<=e[1];if(e[0]==n[0]&&n[1]==e[1]||!t&&!o)return!1}return!0}getRandint(t,e){if(t>e){const n=t;t=e,e=n}return Math.floor(Math.random()*(e-t))+t}finishGame(t){if(c.abort(),cancelAnimationFrame(this.animationFrameId),t.drawClearedGraph(),!this.callback)throw new Error("Property is unsetted");this.callback({time:"3:00.00",cntNode:this.cntNode})}}e.Gamepage=g},108:function(t,e,n){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Resultpage=void 0;const i=o(n(373));class s extends i.default{constructor(t){super(t),this.cntNode=-1}setCallback(t){this.callback=t}changePage(t={time:"--:--.--",cntNode:10}){this.root.innerHTML='\n            <section class="screen-result">\n                <h2>結果</h2>\n\n                \x3c!-- 概要カード --\x3e\n                <article id="result-summary" aria-busy="true">\n                    \x3c!-- タイトル・要約などを動的に挿入 --\x3e\n                </article>\n\n                \x3c!-- メトリクス（任意数のKPIを自由に表示） --\x3e\n                <h3>メトリクス</h3>\n                <table id="result-metrics">\n                    <thead>\n                        <tr><th>項目</th><th>値</th></tr>\n                    </thead>\n                    <tbody>\n                        \x3c!-- 動的に挿入 --\x3e\n                    </tbody>\n                </table>\n\n                \x3c!-- セクション（任意数、配列で増減可能） --\x3e\n                <div id="result-sections">\n                    \x3c!-- 動的に <article> や <details> を追加 --\x3e\n                </div>\n\n                <footer style="margin-top:1rem;">\n                    <button type="button" id="btn_retry">もう一度</button>\n                    <button type="button" id="btn_backtitle" class="secondary">タイトルへ</button>\n                </footer>\n            </section>',this.cntNode=t.cntNode,document.getElementById("btn_retry").addEventListener("click",()=>{if(!this.callback)throw new Error("Property is unsetted");this.callback({page:"game",data:{cntNode:this.cntNode}})}),document.getElementById("btn_backtitle").addEventListener("click",()=>{if(!this.callback)throw new Error("Property is unsetted");this.callback({page:"title"})})}}e.Resultpage=s},267:function(t,e,n){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=o(n(620)),s=document.getElementById("page");function r(){const t=document.documentElement.getAttribute("data-theme")||"light";document.documentElement.setAttribute("data-theme","light"===t?"dark":"light")}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("switch_mode");null==t||t.addEventListener("click",r),new i.default(s,"title")})},373:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.root=t}}},407:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Graph=e.GraphEdge=e.GraphNode=void 0;class n{loop(t){}}class o extends n{constructor(t,e,n,o){super(),this.lastDragedTime=-1,this.prevStatus="normal",this.status="normal",this.graphicGlow=document.createElement("canvas"),this.graphicShadow=document.createElement("canvas"),this.neonColor={core:"#00e5ff",ring:"#0083c4",glowInner:"rgba(0,229,255,0.85)",glowOuter:"rgba(0,229,255,0.0)"},this.neonStyle={radius:18,ringWidth:5,glowRadius:30,pulse:!0,pulsePeriodMS:2e3},this.ctx=t,this.center_x=e,this.center_y=n,this.id=o;const{glowInner:i,glowOuter:s}=this.neonColor,{radius:r,glowRadius:a}=this.neonStyle;this.graphicGlow.height=2*a,this.graphicGlow.width=2*a;const l=a,h=a,c=this.graphicGlow.getContext("2d"),d=c.createRadialGradient(l,h,0,l,h,a);d.addColorStop(0,i),d.addColorStop(1,s),c.fillStyle=d,c.beginPath(),c.arc(l,h,a,0,2*Math.PI),c.fill(),this.graphicShadow.height=2*a,this.graphicShadow.width=2*a;const g=this.graphicShadow.getContext("2d"),u=g.createRadialGradient(l,h,0,l,h,a);u.addColorStop(0,"rgba(255,225,255,0)"),u.addColorStop(.15,"rgba(255,225,255,0.02)"),u.addColorStop(1,"rgba(255,225,255,0.7)"),g.fillStyle=u,g.beginPath(),g.arc(l,h,r,0,2*Math.PI),g.fill()}getPos(){return[this.center_x,this.center_y]}setPos(t,e){this.center_x=t,this.center_y=e}getDist(t,e){return Math.sqrt((this.center_x-t)**2+(e-this.center_y)**2)}loop(t){"drag"==this.prevStatus&&"normal"==this.status&&(this.lastDragedTime=t),this.prevStatus=this.status,this.draw(t)}draw(t){const e=this.ctx,n=this.center_x,o=this.center_y,{core:i,ring:s}=this.neonColor,{radius:r,ringWidth:a,glowRadius:l,pulse:h,pulsePeriodMS:c}=this.neonStyle,d=h?1+.1*Math.cos((t-this.lastDragedTime)/c*Math.PI*2):1,g=l*("drag"===this.status?1.1:d);e.save(),e.globalCompositeOperation="lighter",e.drawImage(this.graphicGlow,n-g,o-g,2*g,2*g),e.restore(),e.fillStyle=i,this.ctx.beginPath(),this.ctx.arc(n,o,r,0,2*Math.PI),this.ctx.fill(),e.strokeStyle=s,e.lineWidth=a,e.beginPath(),e.arc(n,o,.375*r+a,0,2*Math.PI),e.stroke(),e.save(),e.globalCompositeOperation="lighter",e.drawImage(this.graphicShadow,n-l,o-l,2*l,2*l),e.restore()}}e.GraphNode=o;class i extends n{constructor(t,e,n){super(),this.color="black",this.status="normal",this.neonStyle={coreAlpha:.3,coreWidth:1,color:"#00e5ff",colorWidth:3,alertColor:"#ffb703",solvedBoost:1.2,dash:{pattern:[7,7],speed:10},bright:{span:200,speed:100,colorBright:"#00eaffff",colorDim:"#00333aff"},cap:"square",join:"round"},this.ctx=t,this.node1=e,this.node2=n}setColor(t){this.color=t}loop(t){this.draw(t)}draw(t){const[e,n]=this.node1.getPos(),[o,i]=this.node2.getPos(),{coreAlpha:s,coreWidth:r,color:a,colorWidth:l,alertColor:h,solvedBoost:c,dash:d,bright:g,cap:u,join:p}=this.neonStyle,m=this.ctx;this.status,this.status,m.save(),m.globalCompositeOperation="source-over",m.lineCap=u,m.lineJoin=p,m.strokeStyle=`rgba(255,255,255,${s})`,m.lineWidth=r,this.strokeLine(m,e,n,o,i),m.restore(),m.save();const f=Math.atan2(i-n,o-e);m.globalCompositeOperation="lighter",m.lineCap=u,m.lineJoin=p,m.translate(e,n),m.rotate(f);const b=Math.sqrt((o-e)*(o-e)+(i-n)*(i-n)),w=m.createLinearGradient(0,0,b,0),y=t/1e3*g.speed,v=y-Math.floor(y/g.span)*g.span;for(let t=0;;t++){if(g.span/2*t-v>b){const e=t-1,n=Math.round((1-(g.span/2*e-v)/b)/(g.span/2/b)*100);e%2==0?w.addColorStop(1,`color-mix(in srgb, ${g.colorBright} ${n}%, ${g.colorDim})`):w.addColorStop(1,`color-mix(in srgb, ${g.colorDim} ${n}%, ${g.colorBright})`);break}if(g.span/2*t-v<0){if(0<=g.span/2*(t+1)-v){const e=Math.round(-(g.span/2*t-v)/b/(g.span/2/b)*100);t%2==0?w.addColorStop(0,`color-mix(in srgb, ${g.colorBright} ${e}%, ${g.colorDim})`):w.addColorStop(0,`color-mix(in srgb, ${g.colorDim} ${e}%, ${g.colorBright})`)}}else w.addColorStop((g.span/2*t-v)/b,t%2==0?g.colorDim:g.colorBright)}m.fillStyle=w,m.fillRect(0,-l*c/2,b,l*c),m.restore(),m.save(),m.strokeStyle="#0b0f1a",m.lineWidth=l*c*1.2,m.lineDashOffset="solved"===this.status?0:-t/1e3*d.speed,m.setLineDash(d.pattern),this.strokeLine(m,e,n,o,i),m.restore()}strokeLine(t,e,n,o,i){t.beginPath(),t.moveTo(e,n),t.lineTo(o,i),t.stroke()}checkCrossed(t){const[e,n]=this.node1.getPos(),[o,i]=this.node2.getPos(),[s,r]=t.node1.getPos(),[a,l]=t.node2.getPos();if(((e-o)*(r-n)-(n-i)*(s-e))*((e-o)*(l-n)-(n-i)*(a-e))>0)return null;if(((s-a)*(n-r)-(r-l)*(e-s))*((s-a)*(i-r)-(r-l)*(o-s))>0)return null;const h=((n-l)*(s-a)-(e-a)*(r-l))/((n-i)*(s-a)-(e-o)*(r-l));return{y:h*(i-n)+n,x:h*(o-e)+e}}checkNeighbor(t){return this.node1==t.node1||this.node1==t.node2||this.node2==t.node1||this.node2==t.node2}}e.GraphEdge=i,e.Graph=class{constructor(t){this.graphNodes=[],this.graphEdges=[],this.graphicGlow=document.createElement("canvas"),this.ctx=t;const e=this.graphicGlow;e.width=e.height=64;const n=e.getContext("2d"),o=n.createRadialGradient(32,32,0,32,32,24);o.addColorStop(0,"rgba(255,255,255,1)"),o.addColorStop(1,"rgba(255,255,255,0)"),n.fillStyle=o,n.beginPath(),n.arc(32,32,24,0,2*Math.PI),n.fill(),this.graphicGlow=e}getNodes(){return this.graphNodes}getCtx(){return this.ctx}addGraphElement(t){t instanceof o?this.graphNodes.push(t):t instanceof i&&this.graphEdges.push(t)}updateEdgeColor(){const t=this.checkCrossedEdges(),e=this.graphEdges.length;let n=!1;for(let o=0;o<e;o++)this.graphEdges[o].setColor(t[o]?"red":"black"),n||(n=t[o]);return n}checkCrossedGraph(){return!this.checkCrossedEdges().every(t=>!t)}checkCrossedEdges(){const t=this.graphEdges.length;let e=Array(t).fill(!1);for(let n=0;n<t;n++)for(let o=n+1;o<t;o++)this.graphEdges[n].checkNeighbor(this.graphEdges[o])||this.graphEdges[n].checkCrossed(this.graphEdges[o])&&(e[n]=!0,e[o]=!0);return e}culEdgeIntersection(){const t=this.graphEdges.length;let e=[];for(let n=0;n<t;n++)for(let o=n+1;o<t;o++){if(this.graphEdges[n].checkNeighbor(this.graphEdges[o]))continue;const t=this.graphEdges[n].checkCrossed(this.graphEdges[o]);t&&e.push(t)}return e}loop(t){for(const e of this.graphEdges)e.loop(t);for(const e of this.graphNodes)e.loop(t);this.drawSpark(t)}drawSpark(t){const e=this.culEdgeIntersection();console.log(e);for(const t of e){const{x:e,y:n}=t,o=10;this.ctx.drawImage(this.graphicGlow,e-o,n-o,2*o,2*o)}}getClosestNode(t,e){let n=1/0,o=null;for(const i of this.graphNodes){const s=i.getDist(t,e);console.log(`${i.id} ${s}`),n>s&&(n=s,o=i)}return o}drawClearedGraph(){for(const t of this.graphEdges)t.setColor("yellow");console.log("fin")}}},620:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});const o=n(749),i=n(55),s=n(108);e.default=class{constructor(t,e){const n=new o.Titlepage(t),r=new i.Gamepage(t),a=new s.Resultpage(t);n.setCallback(t=>{r.changePage(t)}),r.setCallback(t=>{a.changePage(t)}),a.setCallback(t=>{switch(t.page){case"title":n.changePage();break;case"game":r.changePage(t.data)}}),this._pages={title:n,game:r,result:a},this._pages[e].changePage()}}},749:function(t,e,n){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Titlepage=void 0;const i=o(n(373));class s extends i.default{constructor(t){super(t)}setCallback(t){this.callback=t}changePage(){this.root.innerHTML='\n<section class="screen-title" data-screen>\n    <h1>Planarity Challenge</h1>\n    <p>\n        ランダムに生成された <strong>平面的グラフ</strong> を乱した配置から開始します。<br />\n        頂点をドラッグして <em>辺の交差をなくす</em> ことを目指しましょう。\n    </p>\n\n    <form id="title-form" autocomplete="off">\n        <fieldset>\n            <legend>ゲーム設定</legend>\n\n            <label for="vcount">\n                頂点数\n                <input id="vcount" type="number" min="6" max="60" value="18" required />\n            </label>\n\n            \x3c!-- <label for="edgeRatio">\n                辺密度（0〜1）\n                <input id="edgeRatio" type="range" min="0.1" max="1" step="0.05" value="0.6" />\n                <output id="edgeRatioOut">0.60</output>\n            </label>\n\n            <label for="scramble">\n                初期シャッフル強度\n                <input id="scramble" type="range" min="0" max="1" step="0.05" value="0.7" />\n                <output id="scrambleOut">0.70</output>\n            </label>\n\n            <label for="seed">\n                乱数シード（任意）\n                <input id="seed" type="text" placeholder="例: my-seed-123" />\n                <button type="button" data-action="random-seed">乱数生成</button>\n            </label>\n\n            <label>\n                <input id="autoSnap" type="checkbox" checked />\n                頂点スナップ補助を有効にする\n            </label> --\x3e\n        </fieldset>\n\n        <button type="button" id="btn_gamestart">ゲーム開始</button>\n    </form>\n\n    <details id="howto">\n        <summary>遊び方</summary>\n        <ul>\n            <li>頂点をドラッグして位置を調整します。</li>\n            <li>辺どうしの交差数が <strong>0</strong> になればクリアです。</li>\n            <li>常に「元は平面的なグラフ」を使用しますが、配置を乱して開始します。</li>\n        </ul>\n    </details>\n</section>',document.getElementById("btn_gamestart").addEventListener("click",()=>{const t=Number(document.getElementById("vcount").value);if(!this.callback)throw new Error("Property is unsetted");this.callback({cntNode:t})})}}e.Titlepage=s}},e={};!function n(o){var i=e[o];if(void 0!==i)return i.exports;var s=e[o]={exports:{}};return t[o].call(s.exports,s,s.exports,n),s.exports}(267)})();